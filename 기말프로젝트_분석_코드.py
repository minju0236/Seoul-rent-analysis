# -*- coding: utf-8 -*-
"""ë¹…ë°ë¶„ 4(ì¢…í•©).ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1nFmx55Gn2U2IKY7a40d1Z6gohNOgwTvJ

# ëŒ€í•™ - ë°ì´í„°íƒìƒ‰
"""

!apt-get -y install fonts-nanum

import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm

# CSV íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
file_path = "ì„œìš¸ì‹œ_ëŒ€í•™.csv"
df = pd.read_csv(file_path, encoding='cp949')

# íêµ ë° ì‚¬ì´ë²„ëŒ€í•™ ì œê±°
df = df[df["í•™êµìƒíƒœ"] != "íêµ"]
df = df[~df["í•™êµì¢…ë¥˜"].str.contains("ì‚¬ì´ë²„", na=False)]

# í–‰ì •ë™ â†’ ë²•ì •ë™ ë§¤í•‘ ë”•ì…”ë„ˆë¦¬
hangjeong_to_beopjeong = {
    "ê³µë¦‰2ë™": "ê³µë¦‰ë™",
    "íœ˜ê²½2ë™": "íœ˜ê²½ë™",
    "ì‹ ì´Œë™": "ì°½ì²œë™",
    "í™ì œ2ë™": "í™ì œë™",
    "ì—°ë¬´ì¥1ë™": "ì„±ìˆ˜ë™",
    "ì¥ìœ„2ë™": "ì¥ìœ„ë™",
    "ì²­ìš´íš¨ìë™": "ì²­ìš´ë™",
    "ë‚¨ê°€ì¢Œ2ë™": "ê°€ì¢Œë™",
    "ì‘ì•”2ë™": "ì‘ì•”ë™",
    "ì°½2ë™": "ì°½ë™",
    "ë°©ë°°3ë™": "ë°©ë°°ë™",
    "ì„œì´ˆ1ë™": "ì„œì´ˆë™",
    "ìƒê³„1ë™": "ìƒê³„ë™",
    "ìƒê³„6.7ë™": "ìƒê³„ë™",
    "ì´ë¬¸1ë™": "ì´ë¬¸ë™",
    "ìš°ì¥ì‚°ë™": "í™”ê³¡ë™",
    "ì¢…ë¡œ1.2.3.4ê°€ë™": "í˜œí™”ë™",
    "ë©´ëª©ì œ3.8ë™": "ë©´ëª©ë™",
    "ê³ ì²™1ë™": "ê³ ì²™ë™",
    "ì›”ê³„1ë™": "ì›”ê³„ë™",
    "í™ì€2ë™": "í™ì€ë™",
    "ì‹ ì‚¬1ë™": "ì‹ ì‚¬ë™",
    "ìŒë¬¸1ë™": "ìŒë¬¸ë™",
    "ë…¼í˜„2ë™": "ë…¼í˜„ë™",
    "ê°œë´‰1ë™": "ê°œë´‰ë™",
    "ì •ë¦‰3ë™": "ì •ë¦‰ë™",
    "ì˜¤ë¥˜2ë™": "ì˜¤ë¥˜ë™",
    "ì›”ê³„2ë™": "ì›”ê³„ë™",
    "ë°˜í¬4ë™": "ë°˜í¬ë™",
    "ì‚¬ë‹¹3ë™": "ì‚¬ë‹¹ë™",
    "ìƒë„1ë™": "ìƒë„ë™"
}

# 4. í–‰ì •ë™ â†’ ë²•ì •ë™ ì»¬ëŸ¼ ìƒì„±
df["ë²•ì •ë™ëª…"] = df["í–‰ì •ë™"].apply(lambda x: hangjeong_to_beopjeong.get(x, x))

# 5. ë²•ì •ë™ ê¸°ì¤€ ëŒ€í•™ ìˆ˜ ì§‘ê³„
beopjeong_counts = df["ë²•ì •ë™ëª…"].value_counts().sort_values(ascending=False)

# 6. í•œê¸€ í°íŠ¸ ì„¤ì • (Colab ê¸°ì¤€ ë‚˜ëˆ”ê³ ë”•)
font_path = "/usr/share/fonts/truetype/nanum/NanumGothic.ttf"
fontprop = fm.FontProperties(fname=font_path)

# 7. ì‹œê°í™”
plt.figure(figsize=(16, 6))
plt.bar(beopjeong_counts.index, beopjeong_counts.values, color='lightgreen')
plt.title("ì„œìš¸ì‹œ ë²•ì •ë™ ê¸°ì¤€ ëŒ€í•™ ìˆ˜", fontproperties=fontprop, fontsize=16)
plt.xlabel("ë²•ì •ë™", fontproperties=fontprop)
plt.ylabel("ëŒ€í•™ ìˆ˜", fontproperties=fontprop)
plt.xticks(rotation=90, fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

# ì „ì²´ ëŒ€í•™ ë¦¬ìŠ¤íŠ¸
all_universities = df["í•™êµëª…"].unique().tolist()

# ì „ì²´ ê°œìˆ˜ ì¶œë ¥
print(f"ì´ ëŒ€í•™ ìˆ˜: {len(all_universities)}ê°œ\n")

# ì¶œë ¥
chunk_size = 4
for i in range(0, len(all_universities), chunk_size):
    chunk = all_universities[i:i+chunk_size]
    print(chunk)

"""# ì›”ì„¸ - ë°ì´í„°íƒìƒ‰"""

!fc-cache -fv
!rm -rf ~/.cache/matplotlib

import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
import logging

# ë¡œê¹… ì„¤ì •
logging.getLogger('matplotlib.font_manager').setLevel(logging.ERROR)

# ì—´ ì´ë¦„ ìˆ˜ë™ ì§€ì • í›„ CSV ë¶ˆëŸ¬ì˜¤ê¸°
columns = [
    'ì ‘ìˆ˜ë…„ë„', 'ìì¹˜êµ¬ì½”ë“œ', 'ìì¹˜êµ¬ëª…', 'ë²•ì •ë™ì½”ë“œ', 'ë²•ì •ë™ëª…', 'ì§€ë²ˆêµ¬ë¶„ì½”ë“œ', 'ì§€ë²ˆêµ¬ë¶„',
    'ë³¸ë²ˆ', 'ë¶€ë²ˆ', 'ì¸µ', 'ê³„ì•½ì¼', 'ì „ì›”ì„¸êµ¬ë¶„', 'ì„ëŒ€ë©´ì ', 'ë³´ì¦ê¸ˆ(ë§Œì›)', 'ì„ëŒ€ë£Œ(ë§Œì›)',
    'ê±´ë¬¼ëª…', 'ê±´ì¶•ë…„ë„', 'ê±´ë¬¼ìš©ë„', 'ê³„ì•½ê¸°ê°„', 'ì‹ ê·œê³„ì•½êµ¬ë¶„', 'ê°±ì‹ ì²­êµ¬ê¶Œì‚¬ìš©',
    'ì¢…ì „ë³´ì¦ê¸ˆ', 'ì¢…ì „ì„ëŒ€ë£Œ'
]
df1 = pd.read_csv("ì„œìš¸íŠ¹ë³„ì‹œ_ì „ì›”ì„¸ê°€_2024.csv", encoding='cp949', header=None, names=columns)
df1.columns = df1.columns.str.strip()  # ì—´ ì´ë¦„ ê³µë°± ì œê±°

# ë²•ì •ë™ ì •ë¦¬
df1["ë²•ì •ë™ëª…_ì •ë¦¬"] = df1["ë²•ì •ë™ëª…"].str.replace(r"[1-9]ê°€$", "", regex=True)
print(df1["ë²•ì •ë™ëª…_ì •ë¦¬"].unique())

print("ë²•ì •ë™ ì¢…ë¥˜ ê°œìˆ˜:", df1["ë²•ì •ë™ëª…_ì •ë¦¬"].nunique())

# ë²•ì •ë™ëª…_ì •ë¦¬ ë³„ ë°ì´í„° ê°œìˆ˜ ì§‘ê³„
dong_counts = df1["ë²•ì •ë™ëª…_ì •ë¦¬"].value_counts()

# ìƒìœ„ Nê°œë§Œ ë³´ê¸°
top_n = 20
dong_counts = dong_counts.head(top_n)

# ì‹œê°í™”
plt.figure(figsize=(12, 6))
dong_counts.plot(kind='bar', color='skyblue')
plt.title("ë²•ì •ë™ë³„ ë°ì´í„° ê°œìˆ˜ (ìƒìœ„ 20ê°œ)", fontproperties=fontprop)
plt.xlabel("ë²•ì •ë™ëª…", fontproperties=fontprop)
plt.ylabel("ë°ì´í„° ê°œìˆ˜", fontproperties=fontprop)
plt.xticks(rotation=45, ha='right', fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()

# ì„ëŒ€ë£Œ ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜
df1['ì„ëŒ€ë£Œ(ë§Œì›)'] = pd.to_numeric(df1['ì„ëŒ€ë£Œ(ë§Œì›)'], errors='coerce')
df1 = df1.dropna(subset=['ì„ëŒ€ë£Œ(ë§Œì›)'])

# ë²•ì •ë™ë³„ í‰ê·  ì›”ì„¸ ê³„ì‚°
avg_rent_by_dong = df1.groupby("ë²•ì •ë™ëª…_ì •ë¦¬")["ì„ëŒ€ë£Œ(ë§Œì›)"].mean()

# ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ í›„ ìƒìœ„ 20ê°œ ì„ íƒ
top50_avg_rent = avg_rent_by_dong.sort_values(ascending=False).head(20)

# ì‹œê°í™”
plt.figure(figsize=(15, 8))
top50_avg_rent.plot(kind='bar', color='skyblue')
plt.title("ë²•ì •ë™ë³„ í‰ê·  ì›”ì„¸ ìƒìœ„ 20ê°œ", fontproperties=fontprop)
plt.xlabel("ë²•ì •ë™ëª…", fontproperties=fontprop)
plt.ylabel("í‰ê·  ì„ëŒ€ë£Œ (ë§Œì›)", fontproperties=fontprop)
plt.xticks(rotation=75, ha='right', fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()

# ê±´ë¬¼ìš©ë„ë³„ ë°ì´í„° ê°œìˆ˜ ì§‘ê³„
building_type_counts = df1["ê±´ë¬¼ìš©ë„"].value_counts()

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
building_type_counts.plot(kind='bar', color='skyblue')
plt.title("ê±´ë¬¼ìš©ë„ë³„ ë°ì´í„° ê°œìˆ˜", fontproperties=fontprop)
plt.xlabel("ê±´ë¬¼ìš©ë„", fontproperties=fontprop)
plt.ylabel("ë°ì´í„° ê°œìˆ˜", fontproperties=fontprop)
plt.xticks(rotation=45, ha='right', fontproperties=fontprop)
plt.tight_layout()
plt.grid(axis='y', linestyle='--', alpha=0.5)
plt.show()

# ì„ëŒ€ë©´ì  ìˆ«ìí˜• ë³€í™˜ (ì˜¤ë¥˜ ë¬´ì‹œ)
df1["ì„ëŒ€ë©´ì "] = pd.to_numeric(df1["ì„ëŒ€ë©´ì "], errors="coerce")

# 0 ì´ìƒ ê°’ë§Œ í•„í„°ë§
area_data = df1["ì„ëŒ€ë©´ì "].dropna()
area_data = area_data[area_data > 0]

# êµ¬ê°„ë³„ ê°œìˆ˜ ì§‘ê³„
bin_counts = area_data.value_counts().sort_index()

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
plt.boxplot(area_data, vert=False)
plt.title("ì„ëŒ€ë©´ì  ë°•ìŠ¤í”Œë¡¯", fontproperties=fontprop)
plt.xlabel("ì„ëŒ€ë©´ì  (ã¡)", fontproperties=fontprop)
plt.grid(True, linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

"""# ì§€í•˜ì² ì—­ - ë°ì´í„°íƒìƒ‰"""

import pandas as pd
import re

# CSV ë¶ˆëŸ¬ì˜¤ê¸°
df2 = pd.read_csv("ì„œìš¸êµí†µê³µì‚¬_ì—­ì£¼ì†Œ.csv", encoding='cp949')

# ê´„í˜¸ ì•ˆ ë²•ì •ë™ ì¶”ì¶œ
df2["ê´„í˜¸ì£¼ì†Œ"] = df2["ë„ë¡œëª…ì£¼ì†Œ"].str.extract(r"\((.*?)\)")

# ì •ì œ ëŒ€ìƒ ë¦¬ìŠ¤íŠ¸
raw_dong_list = [
    'ë‚¨ëŒ€ë¬¸ë¡œ 5ê°€', 'ì¢…ë¡œ1ê°€', 'ì¢…ë¡œ3ê°€', 'ì¢…ë¡œ5ê°€', 'ì„ì§€ë¡œ1ê°€', 'ì„ì§€ë¡œ3ê°€', 'ì„ì§€ë¡œ4ê°€', 'ì„ì§€ë¡œ7ê°€',
    'ì„±ìˆ˜ë™1ê°€', 'ì„±ìˆ˜ë™2ê°€', 'ë¬¸ë˜ë™3ê°€', 'ë‹¹ì‚°ë™3ê°€', 'ë‹¹ì‚°ë™6ê°€', 'ì¶©ì •ë¡œ3ê°€', 'í•„ë™2ê°€', 'ì¥ì¶©ë™2ê°€',
    'ê¸ˆí˜¸ë™4ê°€', 'ë™ì„ ë™4ê°€', 'ì‚¼ì„ ë™1ê°€', 'ëª…ë¥œ4ê°€', 'ì¢…ë¡œ6ê°€', 'ê´‘í¬ë™2ê°€', 'ì¶©ë¬´ë¡œ2ê°€', 'í•œê°•ë¡œ1ê°€',
    'í•œê°•ë¡œ2ê°€', 'ìš©ì‚°ë™4ê°€', 'ìš©ì‚°ë™5ê°€', 'ì–‘í‰ë™2ê°€', 'ì˜ë“±í¬ë™5ê°€', 'ì˜ë“±í¬ë™1ê°€', 'ê´‘í¬ë™1ê°€', 'ê¸ˆí˜¸ë™2ê°€',
    'ë³´ë¬¸ë™1ê°€', 'ì•ˆì•”ë™5ê°€', 'ìƒë„1ë™'
]

# ë™ ì •ì œ í•¨ìˆ˜ ì •ì˜
def normalize_legal_dong(name):
    name = name.strip().replace(" ", "")
    name = re.sub(r'\d+ë™$', 'ë™', name)
    name = re.sub(r'\d+ê°€$', '', name)
    return name

# ì •ì œ ë§¤í•‘ ë”•ì…”ë„ˆë¦¬ ìƒì„±
dong_mapping = {
    raw: normalize_legal_dong(raw)
    for raw in raw_dong_list
    if normalize_legal_dong(raw) != raw
}

# ì •ì œëœ ë™ ì´ë¦„ ë¦¬ìŠ¤íŠ¸ ìƒì„±
cleaned_dong_list = []

full_dong_list = df2["ê´„í˜¸ì£¼ì†Œ"].dropna().unique()
for name in full_dong_list:
    cleaned = dong_mapping.get(name, name)
    cleaned_dong_list.append(cleaned)

# ì¤‘ë³µ ì œê±° í›„ ì¶œë ¥
cleaned_dong_list = sorted(set(cleaned_dong_list))
for dong in cleaned_dong_list:
    print(dong)

# df2ì— ì •ì œëœ ë™ ì´ë¦„ ì»¬ëŸ¼ ì¶”ê°€
df2["ë²•ì •ë™"] = df2["ê´„í˜¸ì£¼ì†Œ"].apply(lambda x: dong_mapping.get(x, x) if pd.notna(x) else None)

# í˜¸ì„ ë³„ ì—­ ê°œìˆ˜ ì§‘ê³„
line_counts = df2["í˜¸ì„ "].value_counts().sort_index()

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
plt.bar(line_counts.index, line_counts.values, color='plum')
plt.title("ì„œìš¸ ì§€í•˜ì²  í˜¸ì„ ë³„ ì—­ ê°œìˆ˜", fontproperties=fontprop)
plt.xlabel("í˜¸ì„ ", fontproperties=fontprop)
plt.ylabel("ì—­ ê°œìˆ˜", fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()

station_count_by_dong = df2.groupby("ë²•ì •ë™")["ì—­ëª…"].count().reset_index()
station_count_by_dong.columns = ['ë²•ì •ë™', 'ì§€í•˜ì² ì—­ê°œìˆ˜']
station_count_by_dong = station_count_by_dong.sort_values(by='ì§€í•˜ì² ì—­ê°œìˆ˜', ascending=False)

# ìƒìœ„ 20ê°œ ì¶”ì¶œ
top20_station_counts = station_count_by_dong.head(20)

# ì‹œê°í™”
plt.figure(figsize=(12, 6))
plt.bar(top20_station_counts['ë²•ì •ë™'], top20_station_counts['ì§€í•˜ì² ì—­ê°œìˆ˜'], color='lightpink')
plt.title("ë²•ì •ë™ë³„ ì§€í•˜ì² ì—­ ê°œìˆ˜ (ìƒìœ„ 30ê°œ)", fontproperties=fontprop)
plt.xlabel("ë²•ì •ë™", fontproperties=fontprop)
plt.ylabel("ì§€í•˜ì² ì—­ ê°œìˆ˜", fontproperties=fontprop)
plt.xticks(rotation=75, ha='right', fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()

"""#ê°€ì„¤1"""

# 1) ì›”ì„¸ ë°ì´í„°ì—ì„œ ë²•ì •ë™ë³„ í‰ê·  ì›”ì„¸ ê³„ì‚° (ì´ ë¶€ë¶„ì€ ê·¸ëŒ€ë¡œ)
df_monthly = df1[df1["ì „ì›”ì„¸êµ¬ë¶„"] == "ì›”ì„¸"].copy()
df_monthly["ì„ëŒ€ë£Œ(ë§Œì›)"] = pd.to_numeric(df_monthly["ì„ëŒ€ë£Œ(ë§Œì›)"], errors="coerce")
avg_rent_by_dong = df_monthly.groupby("ë²•ì •ë™ëª…")["ì„ëŒ€ë£Œ(ë§Œì›)"].mean()

# 2) ëŒ€í•™ì´ ìœ„ì¹˜í•œ ë²•ì •ë™ ë¦¬ìŠ¤íŠ¸ë§Œ ì‚¬ìš©
college_dongs = beopjeong_counts.index.tolist()  # ì´ë¯¸ ì „ì²˜ë¦¬ëœ ëŒ€í•™ê°€ ë™ ë¦¬ìŠ¤íŠ¸ë¼ê³  ê°€ì •

# 3) ëŒ€í•™ê°€ì— í•´ë‹¹í•˜ëŠ” í‰ê·  ì›”ì„¸ë§Œ ì¶”ì¶œ
avg_rent_college_only = avg_rent_by_dong[avg_rent_by_dong.index.isin(college_dongs)]

# 4) ì „ì²´ í‰ê·  vs ëŒ€í•™ê°€ í‰ê·  ë¹„êµ
avg_total = avg_rent_by_dong.mean()
avg_college = avg_rent_college_only.mean()

print("ì„œìš¸ ì „ì²´ í‰ê·  ì›”ì„¸:", round(avg_total, 1), "ë§Œì›")
print("ëŒ€í•™ê°€ í‰ê·  ì›”ì„¸:", round(avg_college, 1), "ë§Œì›")

# ì‹œê°í™”
plt.figure(figsize=(6, 5))
plt.bar(["ì„œìš¸ ì „ì²´ í‰ê· ", "ëŒ€í•™ê°€ í‰ê· "], [avg_total, avg_college], color=["gray", "turquoise"])
plt.title("ëŒ€í•™ê°€ vs ì„œìš¸ ì „ì²´ í‰ê·  ì›”ì„¸", fontproperties=fontprop)
plt.ylabel("ì„ëŒ€ë£Œ(ë§Œì›)", fontproperties=fontprop)
plt.xticks(fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

"""ë©´ì ì´ ì‘ì•„ì„œ ì‹¼ê±´ì§€"""

df_monthly["ì„ëŒ€ë©´ì "] = pd.to_numeric(df_monthly["ì„ëŒ€ë©´ì "], errors="coerce")
df_monthly["ã¡ë‹¹ì„ëŒ€ë£Œ"] = df_monthly["ì„ëŒ€ë£Œ(ë§Œì›)"] / df_monthly["ì„ëŒ€ë©´ì "]

# ì „ì²´ í‰ê· 
avg_per_sqm_total = df_monthly["ã¡ë‹¹ì„ëŒ€ë£Œ"].mean()

# ëŒ€í•™ê°€ë§Œ í•„í„°ë§
college_dongs = beopjeong_counts.index.tolist()
df_college = df_monthly[df_monthly["ë²•ì •ë™ëª…"].isin(college_dongs)]

# ëŒ€í•™ê°€ í‰ê· 
avg_per_sqm_college = df_college["ã¡ë‹¹ì„ëŒ€ë£Œ"].mean()

print("ì„œìš¸ ì „ì²´ ã¡ë‹¹ í‰ê·  ì„ëŒ€ë£Œ:", round(avg_per_sqm_total, 2), "ë§Œì›/ã¡")
print("ëŒ€í•™ê°€ ã¡ë‹¹ í‰ê·  ì„ëŒ€ë£Œ:", round(avg_per_sqm_college, 2), "ë§Œì›/ã¡")

plt.figure(figsize=(6, 5))
plt.bar(["ì„œìš¸ ì „ì²´", "ëŒ€í•™ê°€"],
        [avg_per_sqm_total, avg_per_sqm_college],
        color=["gray", "turquoise"])
plt.title("ã¡ë‹¹ í‰ê·  ì„ëŒ€ë£Œ ë¹„êµ", fontproperties=fontprop)
plt.ylabel("ì„ëŒ€ë£Œ (ë§Œì›/ã¡)", fontproperties=fontprop)
plt.xticks(fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.3)
plt.tight_layout()
plt.show()

"""ëŒ€í•™ê°€ë³„ í‰ê·  ì›”ì„¸ ë¹„êµ"""

# 1. ë²•ì •ë™ë³„ í‰ê·  ì›”ì„¸ ê³„ì‚°
avg_rent_by_dong = df_monthly.groupby("ë²•ì •ë™ëª…")["ì„ëŒ€ë£Œ(ë§Œì›)"].mean().reset_index()

# 2. ëŒ€í•™ì´ ìˆëŠ” ë²•ì •ë™ë§Œ í•„í„°ë§
avg_rent_per_college = avg_rent_by_dong[avg_rent_by_dong["ë²•ì •ë™ëª…"].isin(college_dongs)]

# 3. ì„ëŒ€ë£Œ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
avg_rent_per_college = avg_rent_per_college.sort_values(by="ì„ëŒ€ë£Œ(ë§Œì›)", ascending=False)

# 4. ì‹œê°í™” (xì¶•: ë²•ì •ë™ëª…)
plt.figure(figsize=(14, 6))
plt.bar(avg_rent_per_college["ë²•ì •ë™ëª…"], avg_rent_per_college["ì„ëŒ€ë£Œ(ë§Œì›)"], color='turquoise')
plt.title("ëŒ€í•™ê°€ë³„ í‰ê·  ì›”ì„¸ (ë²•ì •ë™ ë‹¨ìœ„)", fontproperties=fontprop)
plt.ylabel("ì„ëŒ€ë£Œ(ë§Œì›)", fontproperties=fontprop)
plt.xticks(rotation=75, ha='right', fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

"""ëŒ€í•™ê°€ë¼ ë¹„ì‹¼ê±´ì§€, ì›ë˜ ë¹„ì‹¼ ë™ë„¤ì— ëŒ€í•™ì´ ìˆì–´ì„œ ê·¸ëŸ°ê±´"""

# 1. ì›”ì„¸ ë°ì´í„° í•„í„°ë§
df_monthly = df1[df1["ì „ì›”ì„¸êµ¬ë¶„"] == "ì›”ì„¸"].copy()

# 2. ìˆ«ìí˜• ë³€í™˜
df_monthly["ì„ëŒ€ë£Œ(ë§Œì›)"] = pd.to_numeric(df_monthly["ì„ëŒ€ë£Œ(ë§Œì›)"], errors="coerce")

# 3. ë²•ì •ë™ë³„ í‰ê·  ì›”ì„¸ ê³„ì‚°
avg_rent_by_dong = df_monthly.groupby(["ìì¹˜êµ¬ëª…", "ë²•ì •ë™ëª…"])["ì„ëŒ€ë£Œ(ë§Œì›)"].mean().reset_index()

# 4. ëŒ€í•™ ìœ ë¬´ í”Œë˜ê·¸ ì¶”ê°€
avg_rent_by_dong["ëŒ€í•™ìœ ë¬´"] = avg_rent_by_dong["ë²•ì •ë™ëª…"].apply(
    lambda x: "ëŒ€í•™ ìˆìŒ" if x in beopjeong_counts.index else "ëŒ€í•™ ì—†ìŒ"
)

# 5. ìì¹˜êµ¬ + ëŒ€í•™ìœ ë¬´ë³„ í‰ê·  ê³„ì‚°
grouped = avg_rent_by_dong.groupby(["ìì¹˜êµ¬ëª…", "ëŒ€í•™ìœ ë¬´"])["ì„ëŒ€ë£Œ(ë§Œì›)"].mean().reset_index()

# 6. í”¼ë²— í…Œì´ë¸” ë§Œë“¤ê¸°
pivot = grouped.pivot(index="ìì¹˜êµ¬ëª…", columns="ëŒ€í•™ìœ ë¬´", values="ì„ëŒ€ë£Œ(ë§Œì›)").dropna()

# 7. ì°¨ì´ ê³„ì‚°
pivot["ì°¨ì´(ë§Œì›)"] = pivot["ëŒ€í•™ ìˆìŒ"] - pivot["ëŒ€í•™ ì—†ìŒ"]
pivot = pivot.sort_values("ì°¨ì´(ë§Œì›)", ascending=False)

plt.figure(figsize=(12, 6))
pivot["ì°¨ì´(ë§Œì›)"].plot(kind="bar", color="turquoise")
plt.axhline(0, color="black", linewidth=0.8)
plt.title("ìì¹˜êµ¬ ë‚´ ëŒ€í•™ ìœ ë¬´ì— ë”°ë¥¸ ë²•ì •ë™ í‰ê·  ì›”ì„¸ ì°¨ì´", fontproperties=fontprop)
plt.ylabel("ëŒ€í•™ ìˆìŒ - ì—†ìŒ (ë§Œì›)", fontproperties=fontprop)
plt.xticks(rotation=75, fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

"""# ê°€ì„¤2"""

# 1-1. ì§€í•˜ì²  ìˆëŠ” ë²•ì •ë™ ë¦¬ìŠ¤íŠ¸ ìƒì„±
subway_dongs = df2["ë²•ì •ë™"].dropna().unique().tolist()

# 1-2. ì›”ì„¸ ë°ì´í„°ì—ì„œ ì›”ì„¸ë§Œ í•„í„°ë§
df_monthly = df1[df1["ì „ì›”ì„¸êµ¬ë¶„"] == "ì›”ì„¸"].copy()
df_monthly["ì„ëŒ€ë£Œ(ë§Œì›)"] = pd.to_numeric(df_monthly["ì„ëŒ€ë£Œ(ë§Œì›)"], errors="coerce")

# 1-3. ëŒ€í•™ì´ ìˆëŠ” ë²•ì •ë™ë§Œ í•„í„°ë§
df_college = df_monthly[df_monthly["ë²•ì •ë™ëª…"].isin(college_dongs)].copy()

# 1-4. ëŒ€í•™ê°€ í‰ê·  ì›”ì„¸ ê³„ì‚°
avg_rent_college = df_college.groupby("ë²•ì •ë™ëª…")["ì„ëŒ€ë£Œ(ë§Œì›)"].mean().reset_index()

# ì§€í•˜ì²  ì ‘ê·¼ì„± í”Œë˜ê·¸ ì¶”ê°€
avg_rent_college["ì ‘ê·¼ì„±"] = avg_rent_college["ë²•ì •ë™ëª…"].apply(
    lambda x: "ì§€í•˜ì²  ìˆìŒ" if x in subway_dongs else "ì§€í•˜ì²  ì—†ìŒ"
)

# ì ‘ê·¼ì„± ê·¸ë£¹ë³„ í‰ê· 
avg_by_access = avg_rent_college.groupby("ì ‘ê·¼ì„±")["ì„ëŒ€ë£Œ(ë§Œì›)"].mean()

# ì‹œê°í™”
plt.figure(figsize=(6, 5))
plt.bar(avg_by_access.index, avg_by_access.values, color=["lightgray", "lightgreen"])
plt.title("ëŒ€í•™ê°€ ì§€í•˜ì²  ì ‘ê·¼ì„±ì— ë”°ë¥¸ í‰ê·  ì›”ì„¸", fontproperties=fontprop)
plt.ylabel("í‰ê·  ì›”ì„¸ (ë§Œì›)", fontproperties=fontprop)
plt.xticks(fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.3)
plt.tight_layout()
plt.show()

# ìˆ˜ì¹˜ ì¶œë ¥
print("ì ‘ê·¼ì„±ë³„ í‰ê·  ì›”ì„¸:\n", avg_by_access.round(2))

"""ê°€ì„¤ê³¼ ë‹¤ë¦„"""

# [1] ì „ì›”ì„¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df_rent = pd.read_csv("ì„œìš¸íŠ¹ë³„ì‹œ_ì „ì›”ì„¸ê°€_2024.csv", encoding="cp949")
df_rent = df_rent[df_rent["ì „ì›”ì„¸êµ¬ë¶„"] == "ì›”ì„¸"].copy()
df_rent["ì„ëŒ€ë£Œ(ë§Œì›)"] = pd.to_numeric(df_rent["ì„ëŒ€ë£Œ(ë§Œì›)"], errors="coerce")

# [2] ë²•ì •ë™ë³„ í‰ê·  ì„ëŒ€ë£Œ ê³„ì‚°
avg_rent_by_dong = df_rent.groupby("ë²•ì •ë™ëª…")["ì„ëŒ€ë£Œ(ë§Œì›)"].mean().reset_index()

# [3] ì§€í•˜ì²  ì£¼ì†Œ ë°ì´í„° ì²˜ë¦¬
df_subway = pd.read_csv("ì„œìš¸êµí†µê³µì‚¬_ì—­ì£¼ì†Œ.csv", encoding="cp949")
df_subway["ê´„í˜¸ì£¼ì†Œ"] = df_subway["ë„ë¡œëª…ì£¼ì†Œ"].str.extract(r"\((.*?)\)")
df_subway = df_subway.dropna(subset=["ê´„í˜¸ì£¼ì†Œ"])
subway_counts = df_subway["ê´„í˜¸ì£¼ì†Œ"].value_counts().reset_index()
subway_counts.columns = ["ë²•ì •ë™ëª…", "ì§€í•˜ì² ì—­ê°œìˆ˜"]

# [4] ë³‘í•©
merged = pd.merge(avg_rent_by_dong, subway_counts, on="ë²•ì •ë™ëª…", how="left")
merged["ì§€í•˜ì² ì—­ê°œìˆ˜"] = merged["ì§€í•˜ì² ì—­ê°œìˆ˜"].fillna(0)

# [5] ìƒê´€ê³„ìˆ˜ í™•ì¸
correlation = merged["ì„ëŒ€ë£Œ(ë§Œì›)"].corr(merged["ì§€í•˜ì² ì—­ê°œìˆ˜"])
print("ğŸ“Š ì§€í•˜ì²  ê°œìˆ˜ì™€ ì›”ì„¸ í‰ê· ì˜ ìƒê´€ê³„ìˆ˜:", round(correlation, 3))

# [1] ëŒ€í•™ê°€ ë²•ì •ë™ ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ
college_dongs = df["ë²•ì •ë™ëª…"].dropna().unique()

# [2] ëŒ€í•™ê°€ í•„í„°ë§
college_df = merged[merged["ë²•ì •ë™ëª…"].isin(college_dongs)]

# [3] ìƒê´€ê³„ìˆ˜ ê³„ì‚°
college_corr = college_df["ì„ëŒ€ë£Œ(ë§Œì›)"].corr(college_df["ì§€í•˜ì² ì—­ê°œìˆ˜"])
print("ğŸ“ ëŒ€í•™ê°€ ë‚´ ì§€í•˜ì²  ê°œìˆ˜ì™€ ì›”ì„¸ í‰ê· ì˜ ìƒê´€ê³„ìˆ˜:", round(college_corr, 3))

# [1] ëŒ€í•™ ìœ„ì¹˜ ë²•ì •ë™
college_dongs_set = set(college_dongs)

# [2] ì§€í•˜ì²  ìœ„ì¹˜ ë²•ì •ë™
subway_dongs_set = set(df_subway["ê´„í˜¸ì£¼ì†Œ"].dropna().unique())

# [3] êµì§‘í•© ë¹„ìœ¨
intersection = college_dongs_set & subway_dongs_set
overlap_rate = len(intersection) / len(college_dongs_set)
print(f"ğŸ§© ëŒ€í•™ê°€ ì¤‘ ì§€í•˜ì² ì—­ì´ ì¡´ì¬í•˜ëŠ” ë¹„ìœ¨: {round(overlap_rate * 100, 1)}%")

"""#ê°€ì„¤3"""

import seaborn as sns

# ê±´ë¬¼ë³„ í‰ê·  ì„ëŒ€ë£Œ ê³„ì‚°
avg_by_type = df_rent.groupby("ê±´ë¬¼ìš©ë„")["ì„ëŒ€ë£Œ(ë§Œì›)"].mean().reset_index()

# ì‹œê°í™” - ë§‰ëŒ€ê·¸ë˜í”„
plt.figure(figsize=(12, 6))
bar = sns.barplot(data=avg_by_type, x="ê±´ë¬¼ìš©ë„", y="ì„ëŒ€ë£Œ(ë§Œì›)",
                  palette=["pink"] * len(avg_by_type),
                  order=avg_by_type.sort_values("ì„ëŒ€ë£Œ(ë§Œì›)", ascending=False)["ê±´ë¬¼ìš©ë„"])

# í‰ê· ì„  ì¶”ê°€
overall_avg = df_rent["ì„ëŒ€ë£Œ(ë§Œì›)"].mean()
plt.axhline(y=overall_avg, color='gray', linestyle='--', label=f'ì „ì²´ í‰ê· : {overall_avg:.1f}ë§Œì›')
plt.legend(prop=fontprop)

# ìˆ«ì ì£¼ì„
for i, val in enumerate(avg_by_type.sort_values("ì„ëŒ€ë£Œ(ë§Œì›)", ascending=False)["ì„ëŒ€ë£Œ(ë§Œì›)"]):
    plt.text(i, val + 1, f'{val:.1f}', ha='center', fontproperties=fontprop)

# ì œëª©/ì¶• ì„¤ì •
plt.title("ê±´ë¬¼ìš©ë„ë³„ í‰ê·  ì›”ì„¸", fontproperties=fontprop, fontsize=14)
plt.xlabel("ê±´ë¬¼ìš©ë„", fontproperties=fontprop)
plt.ylabel("í‰ê·  ì„ëŒ€ë£Œ (ë§Œì›)", fontproperties=fontprop)
plt.xticks(fontproperties=fontprop)
plt.yticks(fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.3)
plt.tight_layout()
plt.show()

"""ëŒ€í•™ê°€ê°€ ìˆëŠ” ë²•ì •ë™ë§Œ í•„í„°ë§í•œ ë°ì´í„°"""

# 1. ëŒ€í•™ ìœ„ì¹˜ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì •ì œ
df_college = pd.read_csv("ì„œìš¸ì‹œ_ëŒ€í•™.csv", encoding="cp949")
df_college = df_college[df_college["í•™êµìƒíƒœ"] != "íêµ"]
df_college = df_college[~df_college["í•™êµì¢…ë¥˜"].str.contains("ì‚¬ì´ë²„", na=False)]
df_college["ë²•ì •ë™ëª…"] = df_college["í–‰ì •ë™"].apply(lambda x: hangjeong_to_beopjeong.get(x, x))

# 2. ëŒ€í•™ê°€ ë²•ì •ë™ ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°
college_dongs = df_college["ë²•ì •ë™ëª…"].unique()

# 3. ì›”ì„¸ ë°ì´í„°ì—ì„œ ëŒ€í•™ê°€ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë§Œ í•„í„°ë§
college_rent_df = df_rent[df_rent["ë²•ì •ë™ëª…"].isin(college_dongs)]

# 4. ê±´ë¬¼ìš©ë„ë³„ í‰ê·  ì„ëŒ€ë£Œ ê³„ì‚°
avg_by_type_college = college_rent_df.groupby("ê±´ë¬¼ìš©ë„")["ì„ëŒ€ë£Œ(ë§Œì›)"].mean().reset_index()

# 5. ì‹œê°í™” - ë§‰ëŒ€ê·¸ë˜í”„
plt.figure(figsize=(12, 6))
bar = sns.barplot(data=avg_by_type_college,
                  x="ê±´ë¬¼ìš©ë„",
                  y="ì„ëŒ€ë£Œ(ë§Œì›)",
                  palette=["pink"] * len(avg_by_type_college),
                  order=avg_by_type_college.sort_values("ì„ëŒ€ë£Œ(ë§Œì›)", ascending=False)["ê±´ë¬¼ìš©ë„"])

# í‰ê· ì„  ì¶”ê°€
college_avg = college_rent_df["ì„ëŒ€ë£Œ(ë§Œì›)"].mean()
plt.axhline(y=college_avg, color='gray', linestyle='--', label=f'ëŒ€í•™ê°€ í‰ê· : {college_avg:.1f}ë§Œì›')
plt.legend(prop=fontprop)

# ìˆ«ì ì£¼ì„
for i, val in enumerate(avg_by_type_college.sort_values("ì„ëŒ€ë£Œ(ë§Œì›)", ascending=False)["ì„ëŒ€ë£Œ(ë§Œì›)"]):
    plt.text(i, val + 1, f'{val:.1f}', ha='center', fontproperties=fontprop)

# ì œëª©/ì¶• ì„¤ì •
plt.title("ëŒ€í•™ê°€ ê±´ë¬¼ìš©ë„ë³„ í‰ê·  ì›”ì„¸", fontproperties=fontprop, fontsize=14)
plt.xlabel("ê±´ë¬¼ìš©ë„", fontproperties=fontprop)
plt.ylabel("í‰ê·  ì„ëŒ€ë£Œ (ë§Œì›)", fontproperties=fontprop)
plt.xticks(fontproperties=fontprop)
plt.yticks(fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.3)
plt.tight_layout()
plt.show()

# ì‹œê°í™”
plt.figure(figsize=(12, 6))
sns.boxplot(
    x='ê±´ë¬¼ìš©ë„',
    y='ì„ëŒ€ë£Œ(ë§Œì›)',
    data=df_rent,
    palette='pink'  # ê¸°ë³¸ pink ìƒ‰ìƒ ì‚¬ìš©
)

plt.title("ê±´ë¬¼ ìœ í˜•ë³„ ì›”ì„¸ ë¶„í¬", fontsize=14, fontproperties=fontprop)
plt.xlabel("ê±´ë¬¼ ìœ í˜•", fontsize=12, fontproperties=fontprop)
plt.ylabel("ì„ëŒ€ë£Œ(ë§Œì›)", fontsize=12, fontproperties=fontprop)
plt.xticks(fontproperties=fontprop)
plt.yticks(fontproperties=fontprop)
plt.grid(axis='y', linestyle='--', alpha=0.3)
plt.tight_layout()
plt.show()

# 1. ë²•ì •ë™ë³„ ê±´ë¬¼ìš©ë„ ê°œìˆ˜ ì§‘ê³„
building_counts = df_rent.groupby(["ë²•ì •ë™ëª…", "ê±´ë¬¼ìš©ë„"]).size().reset_index(name="ê±´ë¬¼ìˆ˜")

# 2. í”¼ë²— í…Œì´ë¸”ë¡œ ë³€í™˜
building_pivot = building_counts.pivot(index="ë²•ì •ë™ëª…", columns="ê±´ë¬¼ìš©ë„", values="ê±´ë¬¼ìˆ˜").fillna(0)

# ê±´ë¬¼ìœ í˜• ë¦¬ìŠ¤íŠ¸ì™€ ìƒ‰ìƒ ì§€ì •
building_types = ["ì˜¤í”¼ìŠ¤í…”", "ë‹¨ë…ë‹¤ê°€êµ¬", "ì•„íŒŒíŠ¸", "ì—°ë¦½ë‹¤ì„¸ëŒ€"]
colors = ["lightcoral", "skyblue", "lightgreen", "plum"]

# ë°˜ë³µë¬¸ìœ¼ë¡œ ê° ìœ í˜•ë³„ ìƒìœ„ 10ê°œ ì‹œê°í™”
for b_type, color in zip(building_types, colors):
    top10 = building_pivot.sort_values(by=b_type, ascending=False).head(10)

    plt.figure(figsize=(12, 6))
    top10[b_type].plot(kind="bar", color=color)
    plt.title(f"ë²•ì •ë™ë³„ {b_type} ê°œìˆ˜ ìƒìœ„ 10ê³³", fontproperties=fontprop)
    plt.xlabel("ë²•ì •ë™", fontproperties=fontprop)
    plt.ylabel(f"{b_type} ìˆ˜", fontproperties=fontprop)
    plt.xticks(rotation=45, fontproperties=fontprop)
    plt.grid(axis="y", linestyle="--", alpha=0.5)
    plt.tight_layout()
    plt.show()

"""#ê²°ë¡ """

# ì‹œê°í™”ìš© ì •ì œ ë°ì´í„° (ì•ì„œ df_vis_sorted ê¸°ì¤€)
df_plot = df_vis_sorted.copy()

# ì‹œê°í™”
fig, axes = plt.subplots(1, 3, figsize=(18, 5))

# â‘  ë³´ì¦ê¸ˆ vs ì„ëŒ€ë£Œ
axes[0].scatter(df_plot["ë³´ì¦ê¸ˆ(ë§Œì›)"], df_plot["ì„ëŒ€ë£Œ(ë§Œì›)"], color='steelblue')
axes[0].set_xlabel("ë³´ì¦ê¸ˆ (ë§Œì›)", fontproperties=fontprop)
axes[0].set_ylabel("ì„ëŒ€ë£Œ (ë§Œì›)", fontproperties=fontprop)
axes[0].set_title("ë³´ì¦ê¸ˆ vs ì„ëŒ€ë£Œ", fontproperties=fontprop)
axes[0].grid(True, linestyle='--', alpha=0.5)

# â‘¡ ì‹¤ì§ˆ ì›”ë¶€ë‹´ (ë³´ì¦ê¸ˆ í™˜ì‚°) vs ë©´ì 
interest_rate = 0.05  # 5% ì—°ì´ìœ¨ ê¸°ì¤€
df_plot["ì‹¤ì§ˆì›”ë¶€ë‹´"] = df_plot["ì„ëŒ€ë£Œ(ë§Œì›)"] + (df_plot["ë³´ì¦ê¸ˆ(ë§Œì›)"] * interest_rate / 12)
axes[1].scatter(df_plot["ì‹¤ì§ˆì›”ë¶€ë‹´"], df_plot["ì„ëŒ€ë©´ì "], color='darkorange')
axes[1].set_xlabel("ì‹¤ì§ˆ ì›”ë¶€ë‹´ (ë§Œì›)", fontproperties=fontprop)
axes[1].set_ylabel("ì„ëŒ€ë©´ì  (ã¡)", fontproperties=fontprop)
axes[1].set_title("ì‹¤ì§ˆ ì›”ë¶€ë‹´ vs ì„ëŒ€ë©´ì ", fontproperties=fontprop)
axes[1].grid(True, linestyle='--', alpha=0.5)

# â‘¢ ë³´ì¦ê¸ˆ vs ê¸°ì¡´ ê°€ì„±ë¹„ì§€ìˆ˜
axes[2].scatter(df_plot["ë³´ì¦ê¸ˆ(ë§Œì›)"], df_plot["ê°€ì„±ë¹„ì§€ìˆ˜"], color='seagreen')
axes[2].set_xlabel("ë³´ì¦ê¸ˆ (ë§Œì›)", fontproperties=fontprop)
axes[2].set_ylabel("ê°€ì„±ë¹„ì§€ìˆ˜ (ã¡ Ã· ì„ëŒ€ë£Œ)", fontproperties=fontprop)
axes[2].set_title("ë³´ì¦ê¸ˆ vs ê°€ì„±ë¹„ì§€ìˆ˜", fontproperties=fontprop)
axes[2].grid(True, linestyle='--', alpha=0.5)

plt.tight_layout()
plt.show()

import matplotlib.pyplot as plt
import seaborn as sns

# íŠ¹ìˆ˜ê¸°í˜¸ ì œê±°í•œ ì»¬ëŸ¼ëª…
df_vis_sorted_eng_simple = df_vis_sorted.rename(columns={
    "ë³´ì¦ê¸ˆ(ë§Œì›)": "Deposit",
    "ì„ëŒ€ë£Œ(ë§Œì›)": "Rent",
    "ì„ëŒ€ë©´ì ": "Area",
    "ê°€ì„±ë¹„ì§€ìˆ˜": "ValueIndex"
})

# ìƒê´€ê´€ê³„ ê³„ì‚°
cols = ["Deposit", "Rent", "Area", "ValueIndex"]
corr = df_vis_sorted_eng_simple[cols].corr()

# íˆíŠ¸ë§µ ê·¸ë¦¬ê¸°
plt.figure(figsize=(6, 4))
sns.heatmap(corr, annot=True, cmap="coolwarm", fmt=".2f")
plt.title("Correlation between Features")
plt.tight_layout()
plt.show()

import statsmodels.api as sm

X = df_vis_sorted[["ë³´ì¦ê¸ˆ(ë§Œì›)", "ì„ëŒ€ë£Œ(ë§Œì›)"]]
y = df_vis_sorted["ê°€ì„±ë¹„ì§€ìˆ˜"]

# ìƒìˆ˜í•­ ì¶”ê°€ (ì ˆí¸)
X = sm.add_constant(X)

# íšŒê·€ ëª¨ë¸ í”¼íŒ…
model = sm.OLS(y, X).fit()
print(model.summary())

from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler

# í´ëŸ¬ìŠ¤í„°ë§ ëŒ€ìƒ ë³€ìˆ˜
features = df_vis_sorted[["ë³´ì¦ê¸ˆ(ë§Œì›)", "ì„ëŒ€ë£Œ(ë§Œì›)", "ì„ëŒ€ë©´ì "]]
scaler = StandardScaler()
scaled = scaler.fit_transform(features)

# KMeans í´ëŸ¬ìŠ¤í„°ë§
kmeans = KMeans(n_clusters=3, random_state=42)
df_vis_sorted["í´ëŸ¬ìŠ¤í„°"] = kmeans.fit_predict(scaled)

# âœ… ì§€í•˜ì²  ìœ ë¬´ ì»¬ëŸ¼ ì¶”ê°€
subway_dong_set = set(df2["ë²•ì •ë™"].dropna().unique())
df_vis_sorted["ì§€í•˜ì² ìœ ë¬´"] = df_vis_sorted["ë²•ì •ë™ëª…"].apply(
    lambda x: "ì§€í•˜ì² O" if x in subway_dong_set else "ì§€í•˜ì² X"
)

# ê°€ì„±ë¹„ ë†’ì€ ìƒìœ„ 20ê°œ ë§¤ë¬¼ ì¶œë ¥
summary_table = df_vis_sorted[["ë²•ì •ë™ëª…", "ê±´ë¬¼ìš©ë„", "ë³´ì¦ê¸ˆ(ë§Œì›)", "ì„ëŒ€ë£Œ(ë§Œì›)", "ì„ëŒ€ë©´ì ", "ê°€ì„±ë¹„ì§€ìˆ˜", "ì§€í•˜ì² ìœ ë¬´"]]
summary_table.head(20).style.background_gradient(cmap="YlGnBu", subset=["ê°€ì„±ë¹„ì§€ìˆ˜"])

# ë°˜ì „ì„¸ ê¸°ì¤€: ë³´ì¦ê¸ˆ â‰¥ ì›”ì„¸ Ã— 240
# ë³´ì¦ê¸ˆì´ 0 ì´ìƒì¸ ì •ìƒ ë°ì´í„°ë§Œ í•„í„°ë§
df_filtered = df_vis_sorted[
    (df_vis_sorted["ë³´ì¦ê¸ˆ(ë§Œì›)"] < df_vis_sorted["ì„ëŒ€ë£Œ(ë§Œì›)"] * 240) &
    (df_vis_sorted["ë³´ì¦ê¸ˆ(ë§Œì›)"] > 0)
]


# ë³´ì¦ê¸ˆ êµ¬ê°„ ì •ì˜
deposit_ranges = [
    (0, 1000),
    (1001, 2000),
    (2001, 3000),
    (3001, float('inf'))  # 3001ë§Œì› ì´ìƒì€ í•˜ë‚˜ë¡œ ë¬¶ê¸°
]

# êµ¬ê°„ë³„ ì¶œë ¥
for start, end in deposit_ranges:
    label = f"{start}ë§Œì› ì´ìƒ" if end == float('inf') else f"{start}ë§Œì› ~ {end}ë§Œì›"
    print(f"\nğŸ“Œ ë³´ì¦ê¸ˆ êµ¬ê°„: {label}\n")

    filtered = df_filtered[
        (df_filtered["ë³´ì¦ê¸ˆ(ë§Œì›)"] >= start) &
        (df_filtered["ë³´ì¦ê¸ˆ(ë§Œì›)"] <= end if end != float('inf') else True)
    ][["ë²•ì •ë™ëª…", "ê±´ë¬¼ìš©ë„", "ë³´ì¦ê¸ˆ(ë§Œì›)", "ì„ëŒ€ë£Œ(ë§Œì›)", "ì„ëŒ€ë©´ì ", "ê°€ì„±ë¹„ì§€ìˆ˜", "ì§€í•˜ì² ìœ ë¬´"]]

    display(
        filtered.sort_values(by="ê°€ì„±ë¹„ì§€ìˆ˜", ascending=False)
        .head(20)
        .style.background_gradient(cmap="YlGnBu", subset=["ê°€ì„±ë¹„ì§€ìˆ˜"])
    )